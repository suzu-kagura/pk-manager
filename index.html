<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Éù„Ç±„Çπ„É™Âé≥ÈÅ∏„Éû„Éç„Éº„Ç∏„É£„Éº</title>
    <style>
        :root {
            --bg: #f0f4f8;
            --card-bg: #ffffff;
            --text-dark: #333;
            /* „Çø„Ç§„ÉóÂà•„Ç´„É©„ÉºË®≠ÂÆö */
            --normal: #A8A878; --fire: #F08030; --water: #6890F0; --grass: #78C850;
            --electric: #F8D030; --ice: #98D8D8; --fighting: #C03028; --poison: #A040A0;
            --ground: #E0C068; --flying: #A890F0; --psychic: #F85888; --bug: #A8B020;
            --rock: #B8A038; --ghost: #705898; --dragon: #7038F8; --steel: #B8B8D0; --fairy: #EE99AC;
            /* „Çµ„Éñ„Çπ„Ç≠„É´„Ç´„É©„Éº */
            --gold-bg: #fff9c4; --gold-border: #fbc02d;
            --blue-bg: #e1f5fe; --blue-border: #4fc3f7;
            --white-bg: #f5f5f5; --white-border: #ddd;
        }

        body { font-family: "Helvetica Neue", Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; background-color: var(--bg); color: var(--text-dark); line-height: 1.5; }
        h1 { text-align: center; color: #2c3e50; margin-bottom: 30px; }

        /* ÂÖ•Âäõ„Éë„Éç„É´ */
        .panel { background: var(--card-bg); padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 20px; }
        label { font-weight: bold; display: block; margin-top: 15px; font-size: 0.85rem; color: #555; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 1rem; margin-top: 5px; }
        
        .row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        .subskill-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; margin-top: 5px; }
        .subskill-group label { margin-top: 0; font-size: 0.75rem; color: #888; }

        /* „Éú„Çø„É≥ */
        .btn-add { background-color: #2ecc71; color: white; border: none; padding: 15px; border-radius: 6px; cursor: pointer; font-size: 1.1rem; font-weight: bold; width: 100%; margin-top: 25px; transition: 0.2s; }
        .btn-add:hover { background-color: #27ae60; }
        
        .io-actions { display: flex; gap: 10px; margin-bottom: 20px; }
        .btn-io { flex: 1; padding: 10px; border-radius: 6px; border: none; cursor: pointer; font-weight: bold; color: white; font-size: 0.9rem; }
        .btn-export { background-color: #4a90e2; }
        .btn-import { background-color: #9b59b6; }

        /* „É™„Çπ„ÉàË°®Á§∫ */
        #pokemon-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; }
        
        /* „Ç´„Éº„Éâ„Éá„Ç∂„Ç§„É≥ */
        .card { background: white; border-radius: 10px; padding: 15px; border-top: 8px solid #ccc; box-shadow: 0 2px 8px rgba(0,0,0,0.08); display: flex; flex-direction: column; position: relative; }
        .btn-del { position: absolute; top: 10px; right: 10px; background: none; border: none; color: #ddd; cursor: pointer; font-size: 1.2rem; }
        .btn-del:hover { color: #ff6b6b; }

        .card-title { font-size: 1.2rem; font-weight: bold; margin-bottom: 5px; }
        .card-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; border-bottom: 1px solid #f0f0f0; padding-bottom: 8px; }
        .nature-text { font-size: 0.85rem; font-weight: bold; color: #666; }
        .ing-display { font-size: 1.3rem; letter-spacing: 2px; }

        /* „Çµ„Éñ„Çπ„Ç≠„É´Ë°®Á§∫ */
        .skills-container { display: flex; flex-wrap: wrap; gap: 4px; }
        .skill-badge { padding: 3px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: bold; border: 1px solid #ddd; }
        
        /* ÂãïÁöÑ„Çø„Ç§„Éó„ÇØ„É©„Çπ */
        .border-normal { border-top-color: var(--normal); } .border-fire { border-top-color: var(--fire); }
        .border-water { border-top-color: var(--water); } .border-grass { border-top-color: var(--grass); }
        .border-electric { border-top-color: var(--electric); } .border-ice { border-top-color: var(--ice); }
        .border-fighting { border-top-color: var(--fighting); } .border-poison { border-top-color: var(--poison); }
        .border-ground { border-top-color: var(--ground); } .border-flying { border-top-color: var(--flying); }
        .border-psychic { border-top-color: var(--psychic); } .border-bug { border-top-color: var(--bug); }
        .border-rock { border-top-color: var(--rock); } .border-ghost { border-top-color: var(--ghost); }
        .border-dragon { border-top-color: var(--dragon); } .border-steel { border-top-color: var(--steel); }
        .border-fairy { border-top-color: var(--fairy); }

        /* „Çπ„Ç≠„É´Ëâ≤„ÇØ„É©„Çπ */
        .s-gold { background: var(--gold-bg); border-color: var(--gold-border); color: #5f4306; }
        .s-blue { background: var(--blue-bg); border-color: var(--blue-border); color: #0277bd; }
        .s-white { background: var(--white-bg); border-color: var(--white-border); color: #666; }

        #file-input { display: none; }
    </style>
</head>
<body>

    <h1>üò¥ „Éù„Ç±„Çπ„É™Âé≥ÈÅ∏„Éû„Éç„Éº„Ç∏„É£„Éº</h1>

    <div class="io-actions">
        <button class="btn-io btn-export" onclick="exportData()">üíæ „Éá„Éº„Çø„Çí‰øùÂ≠ò (Export)</button>
        <button class="btn-io btn-import" onclick="document.getElementById('file-input').click()">üìÇ „Éá„Éº„Çø„ÇíË™≠Ëæº (Import)</button>
        <input type="file" id="file-input" accept=".json" onchange="importData(this)">
    </div>

    <div class="panel">
        <label>„Éù„Ç±„É¢„É≥ÈÅ∏Êäû</label>
        <select id="p-name-select" onchange="onPokemonChange()">
            <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
        </select>

        <label>ÊÄßÊ†º</label>
        <select id="p-nature"></select>

        <label>È£üÊùê (Lv1 / Lv30 / Lv60)</label>
        <div class="row-3">
            <select id="ing-1"></select>
            <select id="ing-30"></select>
            <select id="ing-60"></select>
        </div>

        <label>„Çµ„Éñ„Çπ„Ç≠„É´</label>
        <div class="subskill-grid" id="subskill-inputs">
            </div>

        <button class="btn-add" onclick="addPokemon()">„Éù„Ç±„É¢„É≥„ÇíÁôªÈå≤</button>
    </div>

    <div id="pokemon-list"></div>

    <script src="pkmn_db.js"></script>

    <script>
        // „Çµ„Éñ„Çπ„Ç≠„É´ÂÆöÁæ©
        const SKILLS = {
            gold: ["„Åç„ÅÆ„Åø„ÅÆÊï∞S", "„Åä„Å¶„Å§„Å†„ÅÑ„Éú„Éº„Éä„Çπ", "Áù°Áú†EXP„Éú„Éº„Éä„Çπ", "„É™„Çµ„Éº„ÉÅEXP„Éú„Éº„Éä„Çπ", "„ÇÜ„ÇÅ„ÅÆ„Åã„Åë„Çâ„Éú„Éº„Éä„Çπ", "ÂÖÉÊ∞óÂõûÂæ©„Éú„Éº„Éä„Çπ"],
            blue: ["„Åä„Å¶„Å§„Å†„ÅÑ„Çπ„Éî„Éº„ÉâM", "È£üÊùêÁ¢∫Áéá„Ç¢„ÉÉ„ÉóM", "„Çπ„Ç≠„É´Á¢∫Áéá„Ç¢„ÉÉ„ÉóM", "ÊúÄÂ§ßÊâÄÊåÅÊï∞„Ç¢„ÉÉ„ÉóL", "ÊúÄÂ§ßÊâÄÊåÅÊï∞„Ç¢„ÉÉ„ÉóM", "„Çπ„Ç≠„É´„É¨„Éô„É´„Ç¢„ÉÉ„ÉóM"],
            white: ["„Åä„Å¶„Å§„Å†„ÅÑ„Çπ„Éî„Éº„ÉâS", "È£üÊùêÁ¢∫Áéá„Ç¢„ÉÉ„ÉóS", "„Çπ„Ç≠„É´Á¢∫Áéá„Ç¢„ÉÉ„ÉóS", "ÊúÄÂ§ßÊâÄÊåÅÊï∞„Ç¢„ÉÉ„ÉóS", "„Çπ„Ç≠„É´„É¨„Éô„É´„Ç¢„ÉÉ„ÉóS"]
        };

        const NATURES = {
            "„ÅÑ„Åò„Å£„Å±„Çä": "‚ñ≤„ÅäÊâã‰ºù„ÅÑ ‚ñºÈ£üÊùê", "„Å≤„Åã„Åà„ÇÅ": "‚ñ≤È£üÊùê ‚ñº„ÅäÊâã‰ºù„ÅÑ", "„Çà„ÅÜ„Åç": "‚ñ≤EXP ‚ñºÈ£üÊùê", 
            "„Åä„Åè„Å≥„Çá„ÅÜ": "‚ñ≤EXP ‚ñº„ÅäÊâã‰ºù„ÅÑ", "„Åö„Å∂„Å®„ÅÑ": "‚ñ≤ÂÖÉÊ∞ó ‚ñº„ÅäÊâã‰ºù„ÅÑ", "„Çè„Çì„Å±„Åè": "‚ñ≤ÂÖÉÊ∞ó ‚ñºÈ£üÊùê",
            "„Åä„Å†„ÇÑ„Åã": "‚ñ≤„Çπ„Ç≠„É´ ‚ñº„ÅäÊâã‰ºù„ÅÑ", "„Åó„Çì„Å°„Çá„ÅÜ": "‚ñ≤„Çπ„Ç≠„É´ ‚ñºÈ£üÊùê", "„Åæ„Åò„ÇÅ": "„Å™„Åó", 
            "„Åå„Çì„Å∞„Çä„ÇÑ": "„Å™„Åó", "„Åô„Å™„Åä": "„Å™„Åó", "„Å¶„Çå„ÇÑ": "„Å™„Åó", "„Åç„Åæ„Åê„Çå": "„Å™„Åó"
        };

        window.onload = () => {
            // „Éù„Ç±„É¢„É≥Âêç„É™„Çπ„ÉàÁîüÊàê
            const nameSel = document.getElementById('p-name-select');
            if(typeof POKEMON_DB !== 'undefined') {
                POKEMON_DB.forEach(p => nameSel.add(new Option(p.name, p.name)));
            } else {
                alert("pkmn_db.js „ÅåË™≠„ÅøËæº„ÇÅ„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ„Éï„Ç°„Ç§„É´Âêç„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ");
            }

            // ÊÄßÊ†º„É™„Çπ„ÉàÁîüÊàê
            const natureSel = document.getElementById('p-nature');
            Object.keys(NATURES).forEach(n => natureSel.add(new Option(`${n} (${NATURES[n]})`, n)));

            // „Çµ„Éñ„Çπ„Ç≠„É´ÂÖ•ÂäõÊ¨ÑÁîüÊàê
            const subContainer = document.getElementById('subskill-inputs');
            const levels = [10, 25, 50, 75, 100];
            levels.forEach(lv => {
                const div = document.createElement('div');
                div.className = "subskill-group";
                div.innerHTML = `<label>Lv${lv}</label>`;
                const sel = document.createElement('select');
                sel.className = "sub-input";
                sel.add(new Option("---", ""));
                
                const addGrp = (label, list) => {
                    const grp = document.createElement('optgroup'); grp.label = label;
                    list.forEach(s => grp.add(new Option(s, s)));
                    sel.appendChild(grp);
                };
                addGrp("Èáë", SKILLS.gold);
                addGrp("Èùí", SKILLS.blue);
                addGrp("ÁôΩ", SKILLS.white);
                
                div.appendChild(sel);
                subContainer.appendChild(div);
            });

            loadCards();
        };

        // „Éù„Ç±„É¢„É≥ÈÅ∏ÊäûÊôÇ„ÅÆÈ£üÊùêÁµû„ÇäËæº„Åø
        function onPokemonChange() {
            const name = document.getElementById('p-name-select').value;
            const data = POKEMON_DB.find(p => p.name === name);
            if(!data) return;

            const ingSels = [document.getElementById('ing-1'), document.getElementById('ing-30'), document.getElementById('ing-60')];
            
            ingSels.forEach((sel, idx) => {
                sel.innerHTML = "";
                // Á¨¨1:A„ÅÆ„Åø, Á¨¨2:AorB, Á¨¨3:AorBorC
                const options = [data.ings.A];
                if(idx >= 1) options.push(data.ings.B);
                if(idx >= 2) options.push(data.ings.C);
                
                // ÈáçË§áÂâäÈô§„Åó„Å¶ËøΩÂä†
                [...new Set(options)].forEach(emoji => sel.add(new Option(emoji, emoji)));
            });
        }

        function addPokemon() {
            const name = document.getElementById('p-name-select').value;
            if(!name) return alert("„Éù„Ç±„É¢„É≥„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ");
            
            const data = POKEMON_DB.find(p => p.name === name);
            const pokemon = {
                id: Date.now(),
                name: name,
                type: data.type,
                nature: document.getElementById('p-nature').value,
                ings: [document.getElementById('ing-1').value, document.getElementById('ing-30').value, document.getElementById('ing-60').value],
                skills: Array.from(document.querySelectorAll('.sub-input')).map(s => s.value)
            };

            const list = JSON.parse(localStorage.getItem('ps_data') || '[]');
            list.push(pokemon);
            localStorage.setItem('ps_data', JSON.stringify(list));
            loadCards();
        }

        function loadCards() {
            const container = document.getElementById('pokemon-list');
            container.innerHTML = "";
            const list = JSON.parse(localStorage.getItem('ps_data') || '[]');

            list.reverse().forEach(p => {
                const card = document.createElement('div');
                card.className = `card border-${p.type}`;
                
                let skillsHtml = p.skills.map(s => {
                    if(!s) return '';
                    let colorClass = "s-white";
                    if(SKILLS.gold.includes(s)) colorClass = "s-gold";
                    else if(SKILLS.blue.includes(s)) colorClass = "s-blue";
                    return `<span class="skill-badge ${colorClass}">${s}</span>`;
                }).join('');

                card.innerHTML = `
                    <button class="btn-del" onclick="deletePokemon(${p.id})">√ó</button>
                    <div class="card-title">${p.name}</div>
                    <div class="card-info">
                        <span class="nature-text">${p.nature}</span>
                        <div class="ing-display">${p.ings.join('')}</div>
                    </div>
                    <div class="skills-container">${skillsHtml}</div>
                `;
                container.appendChild(card);
            });
        }

        function deletePokemon(id) {
            if(!confirm("ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü")) return;
            const list = JSON.parse(localStorage.getItem('ps_data') || '[]');
            const newList = list.filter(p => p.id !== id);
            localStorage.setItem('ps_data', JSON.stringify(newList));
            loadCards();
        }

        function exportData() {
            const data = localStorage.getItem('ps_data');
            const blob = new Blob([data], {type: "application/json"});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `pokesleep_data_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
        }

        function importData(input) {
            const reader = new FileReader();
            reader.onload = (e) => {
                localStorage.setItem('ps_data', e.target.result);
                loadCards();
                alert("Ë™≠„ÅøËæº„Åø„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü");
            };
            reader.readAsText(input.files[0]);
        }
    </script>
</body>
</html>
