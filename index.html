<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Éù„Ç±„Çπ„É™Âé≥ÈÅ∏„Éû„Éç„Éº„Ç∏„É£„Éº</title>
    <style>
        :root {
            --bg: #f0f4f8;
            --card-bg: #ffffff;
            --text-dark: #333;
            /* „Çø„Ç§„ÉóÂà•„Ç´„É©„Éº */
            --normal: #A8A878; --fire: #F08030; --water: #6890F0; --grass: #78C850;
            --electric: #F8D030; --ice: #98D8D8; --fighting: #C03028; --poison: #A040A0;
            --ground: #E0C068; --flying: #A890F0; --psychic: #F85888; --bug: #A8B020;
            --rock: #B8A038; --ghost: #705898; --dragon: #7038F8; --steel: #B8B8D0; --fairy: #EE99AC;
            /* „Çµ„Éñ„Çπ„Ç≠„É´„Ç´„É©„Éº */
            --gold-bg: #fff9c4; --gold-border: #fbc02d;
            --blue-bg: #e1f5fe; --blue-border: #4fc3f7;
            --white-bg: #f5f5f5; --white-border: #ddd;
        }
        body { font-family: sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; background-color: var(--bg); color: var(--text-dark); }
        .panel { background: var(--card-bg); padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 20px; }
        label { font-weight: bold; display: block; margin-top: 15px; font-size: 0.85rem; color: #555; }
        select, input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 1rem; margin-top: 5px; }
        .row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        .subskill-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; }
        .subskill-group label { margin-top: 5px; font-size: 0.75rem; color: #888; font-weight: normal; }
        .btn-add { background-color: #2ecc71; color: white; border: none; padding: 15px; border-radius: 6px; cursor: pointer; font-size: 1.1rem; font-weight: bold; width: 100%; margin-top: 25px; }
        .io-actions { display: flex; gap: 10px; margin-bottom: 20px; }
        .btn-io { flex: 1; padding: 10px; border-radius: 6px; border: none; cursor: pointer; font-weight: bold; color: white; }
        .btn-export { background-color: #4a90e2; } .btn-import { background-color: #9b59b6; }
        #pokemon-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; }
        .card { background: white; border-radius: 10px; padding: 15px; border-top: 8px solid #ccc; box-shadow: 0 2px 8px rgba(0,0,0,0.08); position: relative; }
        .btn-del { position: absolute; top: 10px; right: 10px; background: none; border: none; color: #ddd; cursor: pointer; font-size: 1.2rem; }
        .card-title { font-size: 1.1rem; font-weight: bold; margin-bottom: 8px; }
        .card-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .nature-text { font-size: 0.8rem; color: #666; font-weight: bold; }
        .ing-display { font-size: 1.3rem; letter-spacing: 2px; }
        .skill-badge { padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; border: 1px solid #ddd; margin: 2px; display: inline-block; }
        .s-gold { background: var(--gold-bg); border-color: var(--gold-border); color: #5f4306; }
        .s-blue { background: var(--blue-bg); border-color: var(--blue-border); color: #0277bd; }
        .s-white { background: var(--white-bg); border-color: var(--white-border); }
        /* „Çø„Ç§„ÉóÂà•„ÇØ„É©„Çπ */
        .border-normal { border-top-color: var(--normal); } .border-fire { border-top-color: var(--fire); }
        .border-water { border-top-color: var(--water); } .border-grass { border-top-color: var(--grass); }
        .border-electric { border-top-color: var(--electric); } .border-ice { border-top-color: var(--ice); }
        .border-fighting { border-top-color: var(--fighting); } .border-poison { border-top-color: var(--poison); }
        .border-ground { border-top-color: var(--ground); } .border-flying { border-top-color: var(--flying); }
        .border-psychic { border-top-color: var(--psychic); } .border-bug { border-top-color: var(--bug); }
        .border-rock { border-top-color: var(--rock); } .border-ghost { border-top-color: var(--ghost); }
        .border-dragon { border-top-color: var(--dragon); } .border-steel { border-top-color: var(--steel); }
        .border-fairy { border-top-color: var(--fairy); }
        #file-input { display: none; }
    </style>
</head>
<body>

    <h1>üò¥ „Éù„Ç±„Çπ„É™Âé≥ÈÅ∏„Éû„Éç„Éº„Ç∏„É£„Éº</h1>

    <div class="io-actions">
        <button class="btn-io btn-export" onclick="exportData()">üíæ ‰øùÂ≠ò</button>
        <button class="btn-io btn-import" onclick="document.getElementById('file-input').click()">üìÇ Ë™≠Ëæº</button>
        <input type="file" id="file-input" accept=".json" onchange="importData(this)">
    </div>

    <div class="panel">
        <label>„Éù„Ç±„É¢„É≥ÈÅ∏Êäû</label>
        <select id="p-name-select" onchange="onPokemonChange()">
            <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
        </select>

        <label>ÊÄßÊ†º</label>
        <select id="p-nature"></select>

        <label>È£üÊùê (Lv1 / 30 / 60)</label>
        <div class="row-3">
            <select id="ing-1"></select>
            <select id="ing-30"></select>
            <select id="ing-60"></select>
        </div>

        <label>„Çµ„Éñ„Çπ„Ç≠„É´</label>
        <div class="subskill-grid" id="subskill-inputs"></div>

        <button class="btn-add" onclick="addPokemon()">„Éù„Ç±„É¢„É≥„ÇíÁôªÈå≤</button>
    </div>

    <div id="pokemon-list"></div>

    <script src="pkmn_db.js"></script>

    <script>
        const SKILLS = {
            gold: ["„Åç„ÅÆ„Åø„ÅÆÊï∞S", "„Åä„Å¶„Å§„Å†„ÅÑ„Éú„Éº„Éä„Çπ", "Áù°Áú†EXP„Éú„Éº„Éä„Çπ", "„É™„Çµ„Éº„ÉÅEXP„Éú„Éº„Éä„Çπ", "„ÇÜ„ÇÅ„ÅÆ„Åã„Åë„Çâ„Éú„Éº„Éä„Çπ", "ÂÖÉÊ∞óÂõûÂæ©„Éú„Éº„Éä„Çπ"],
            blue: ["„Åä„Å¶„Å§„Å†„ÅÑ„Çπ„Éî„Éº„ÉâM", "È£üÊùêÁ¢∫Áéá„Ç¢„ÉÉ„ÉóM", "„Çπ„Ç≠„É´Á¢∫Áéá„Ç¢„ÉÉ„ÉóM", "ÊúÄÂ§ßÊâÄÊåÅÊï∞„Ç¢„ÉÉ„ÉóL", "ÊúÄÂ§ßÊâÄÊåÅÊï∞„Ç¢„ÉÉ„ÉóM", "„Çπ„Ç≠„É´„É¨„Éô„É´„Ç¢„ÉÉ„ÉóM"],
            white: ["„Åä„Å¶„Å§„Å†„ÅÑ„Çπ„Éî„Éº„ÉâS", "È£üÊùêÁ¢∫Áéá„Ç¢„ÉÉ„ÉóS", "„Çπ„Ç≠„É´Á¢∫Áéá„Ç¢„ÉÉ„ÉóS", "ÊúÄÂ§ßÊâÄÊåÅÊï∞„Ç¢„ÉÉ„ÉóS", "„Çπ„Ç≠„É´„É¨„Éô„É´„Ç¢„ÉÉ„ÉóS"]
        };

        const NATURES = {
            "„ÅÑ„Åò„Å£„Å±„Çä": "‚ñ≤„ÅäÊâã‰ºù„ÅÑ ‚ñºÈ£üÊùê", "„Å≤„Åã„Åà„ÇÅ": "‚ñ≤È£üÊùê ‚ñº„ÅäÊâã‰ºù„ÅÑ", "„Çà„ÅÜ„Åç": "‚ñ≤EXP ‚ñºÈ£üÊùê", 
            "„Åä„Åè„Å≥„Çá„ÅÜ": "‚ñ≤EXP ‚ñº„ÅäÊâã‰ºù„ÅÑ", "„Åö„Å∂„Å®„ÅÑ": "‚ñ≤ÂÖÉÊ∞ó ‚ñº„ÅäÊâã‰ºù„ÅÑ", "„Çè„Çì„Å±„Åè": "‚ñ≤ÂÖÉÊ∞ó ‚ñºÈ£üÊùê",
            "„Åä„Å†„ÇÑ„Åã": "‚ñ≤„Çπ„Ç≠„É´ ‚ñº„ÅäÊâã‰ºù„ÅÑ", "„Åó„Çì„Å°„Çá„ÅÜ": "‚ñ≤„Çπ„Ç≠„É´ ‚ñºÈ£üÊùê", "„Åæ„Åò„ÇÅ": "„Å™„Åó", "„Åå„Çì„Å∞„Çä„ÇÑ": "„Å™„Åó", "„Åô„Å™„Åä": "„Å™„Åó", "„Å¶„Çå„ÇÑ": "„Å™„Åó", "„Åç„Åæ„Åê„Çå": "„Å™„Åó"
        };

        const ING_NAME_MAP = {
            "üçé": "„É™„É≥„Ç¥", "ü•õ": "„Éü„É´„ÇØ", "ü´ò": "Â§ßË±Ü", "üçØ": "„Éü„ÉÑ", "üå≠": "ËÇâ", "ü´ö": "„Ç∏„É≥„Ç∏„É£„Éº", 
            "üçÖ": "„Éà„Éû„Éà", "ü•ö": "„Çø„Éû„Ç¥", "ü´í": "„Ç™„Ç§„É´", "ü•î": "„Éù„ÉÜ„Éà", "üåø": "„Éè„Éº„Éñ", "üåΩ": "„Ç≥„Éº„É≥", 
            "üç´": "„Ç´„Ç´„Ç™", "üçÑ": "„Ç≠„Éé„Ç≥", "üå±": "„Éç„ÇÆ", "üçñ": "„Ç∑„ÉÉ„Éù", "‚òï": "„Ç≥„Éº„Éí„Éº"
        };

        window.onload = () => {
            // „Éù„Ç±„É¢„É≥Âêç
            const nameSel = document.getElementById('p-name-select');
            if(typeof POKEMON_DB !== 'undefined') {
                POKEMON_DB.forEach(p => nameSel.add(new Option(p.name, p.name)));
            }

            // ÊÄßÊ†º
            const natureSel = document.getElementById('p-nature');
            Object.keys(NATURES).forEach(n => natureSel.add(new Option(`${n} (${NATURES[n]})`, n)));

            // „Çµ„Éñ„Çπ„Ç≠„É´ÁîüÊàê
            const subContainer = document.getElementById('subskill-inputs');
            [10, 25, 50, 75, 100].forEach(lv => {
                const div = document.createElement('div');
                div.className = "subskill-group";
                div.innerHTML = `<label>Lv${lv}</label>
                    <select class="sub-input">
                        <option value="">---</option>
                        <optgroup label="Èáë">${SKILLS.gold.map(s => `<option value="${s}">${s}</option>`).join('')}</optgroup>
                        <optgroup label="Èùí">${SKILLS.blue.map(s => `<option value="${s}">${s}</option>`).join('')}</optgroup>
                        <optgroup label="ÁôΩ">${SKILLS.white.map(s => `<option value="${s}">${s}</option>`).join('')}</optgroup>
                    </select>`;
                subContainer.appendChild(div);
            });

            loadCards();
        };

        function onPokemonChange() {
            const name = document.getElementById('p-name-select').value;
            const data = POKEMON_DB.find(p => p.name === name);
            if(!data) return;

            [document.getElementById('ing-1'), document.getElementById('ing-30'), document.getElementById('ing-60')].forEach((sel, idx) => {
                sel.innerHTML = "";
                const opts = [data.ings.A];
                if(idx >= 1) opts.push(data.ings.B);
                if(idx >= 2) opts.push(data.ings.C);
                [...new Set(opts)].forEach(emoji => {
                    sel.add(new Option(`${emoji} ${ING_NAME_MAP[emoji] || ''}`, emoji));
                });
            });
        }

        function addPokemon() {
            const name = document.getElementById('p-name-select').value;
            if(!name) return;
            const data = POKEMON_DB.find(p => p.name === name);
            const pokemon = {
                id: Date.now(),
                name: name,
                type: data.type,
                nature: document.getElementById('p-nature').value,
                ings: [document.getElementById('ing-1').value, document.getElementById('ing-30').value, document.getElementById('ing-60').value],
                skills: Array.from(document.querySelectorAll('.sub-input')).map(s => s.value)
            };
            const list = JSON.parse(localStorage.getItem('ps_data') || '[]');
            list.push(pokemon);
            localStorage.setItem('ps_data', JSON.stringify(list));
            loadCards();
        }

        function loadCards() {
            const container = document.getElementById('pokemon-list');
            container.innerHTML = "";
            const list = JSON.parse(localStorage.getItem('ps_data') || '[]');
            list.reverse().forEach(p => {
                const card = document.createElement('div');
                card.className = `card border-${p.type}`;
                let sHtml = p.skills.map(s => {
                    if(!s) return '';
                    let c = SKILLS.gold.includes(s) ? "s-gold" : (SKILLS.blue.includes(s) ? "s-blue" : "s-white");
                    return `<span class="skill-badge ${c}">${s}</span>`;
                }).join('');
                card.innerHTML = `<button class="btn-del" onclick="deletePokemon(${p.id})">√ó</button>
                    <div class="card-title">${p.name}</div>
                    <div class="card-info"><span class="nature-text">${p.nature}</span><div class="ing-display">${p.ings.join('')}</div></div>
                    <div>${sHtml}</div>`;
                container.appendChild(card);
            });
        }

        function deletePokemon(id) {
            if(!confirm("ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü")) return;
            const list = JSON.parse(localStorage.getItem('ps_data') || '[]').filter(p => p.id !== id);
            localStorage.setItem('ps_data', JSON.stringify(list));
            loadCards();
        }

        function exportData() {
            const blob = new Blob([localStorage.getItem('ps_data')], {type: "application/json"});
            const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
            a.download = `pokesleep_data.json`; a.click();
        }

        function importData(input) {
            const reader = new FileReader();
            reader.onload = (e) => { localStorage.setItem('ps_data', e.target.result); loadCards(); };
            reader.readAsText(input.files[0]);
        }
    </script>
</body>
</html>
