<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Éù„Ç±„Çπ„É™Âé≥ÈÅ∏„Éû„Éç„Éº„Ç∏„É£„Éº</title>
    <style>
        :root {
            --primary: #4a90e2;
            --bg: #f0f4f8;
            --card-bg: #ffffff;
            --danger: #ff6b6b;
            --gold-skill: #ffd700;
            --blue-skill: #87ceeb;
            --white-skill: #f0f0f0;
            --text-dark: #333;
        }
        body { font-family: sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; background-color: var(--bg); color: var(--text-dark); }
        h1 { text-align: center; color: #2c3e50; margin-bottom: 20px; }

        .panel { background: var(--card-bg); padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 20px; }

        /* „Éï„Ç©„Éº„É†Ë¶ÅÁ¥† */
        label { font-weight: bold; display: block; margin-top: 15px; font-size: 0.85rem; margin-bottom: 5px; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 0.95rem; }
        
        .row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        .subskill-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; }
        .subskill-group label { margin-top: 0; font-size: 0.75rem; color: #888; }

        /* „Éú„Çø„É≥ */
        .btn { border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 1rem; font-weight: bold; width: 100%; margin-top: 20px; }
        .btn-add { background-color: #2ecc71; color: white; }
        .io-actions { display: flex; gap: 10px; margin-bottom: 20px; }
        .btn-dl { background-color: var(--primary); color: white; flex: 1; text-decoration: none; text-align: center; line-height: 40px; height: 40px; padding: 0;}
        .btn-imp { background-color: #9b59b6; color: white; flex: 1; }
        #file-input { display: none; }

        /* „Ç´„Éº„Éâ„Ç∞„É™„ÉÉ„Éâ„É¨„Ç§„Ç¢„Ç¶„Éà */
        #pokemon-list { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); 
            gap: 15px; 
        }

        .card { 
            background: white; border-radius: 8px; padding: 12px; 
            border-top: 6px solid #ccc; box-shadow: 0 2px 4px rgba(0,0,0,0.05); 
            display: flex; flex-direction: column;
        }
        .card.has-gold { border-top-color: var(--gold-skill); }
        
        .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; }
        .card-title { font-size: 1.1rem; font-weight: bold; }
        .btn-del { background: none; border: none; color: #ccc; cursor: pointer; font-size: 1.2rem; line-height: 1; }
        
        .info-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; font-size: 0.85rem; }
        .nature-up { color: #e74c3c; font-weight: bold; }
        .nature-down { color: #3498db; font-weight: bold; }

        .ing-emoji-list { font-size: 1.2rem; letter-spacing: 2px; }

        .skills-list { display: flex; flex-wrap: wrap; gap: 4px; }
        .skill-tag { padding: 2px 6px; border-radius: 4px; font-size: 0.75rem; background: var(--white-skill); border: 1px solid #ddd; }
        .skill-gold { background: #fff9c4; border: 1px solid #fbc02d; color: #5f4306; font-weight: bold;}
        .skill-blue { background: #e1f5fe; border: 1px solid #4fc3f7; color: #0277bd; }
    </style>
</head>
<body>

    <h1>üò¥ „Éù„Ç±„Çπ„É™Âé≥ÈÅ∏„Éû„Éç„Éº„Ç∏„É£„Éº</h1>

    <div class="io-actions">
        <button class="btn btn-dl" onclick="exportData()">üíæ ‰øùÂ≠ò (Export)</button>
        <button class="btn btn-imp" onclick="document.getElementById('file-input').click()">üìÇ Ë™≠Ëæº (Import)</button>
        <input type="file" id="file-input" accept=".json" onchange="importData(this)">
    </div>

    <div class="panel">
        <label>„Éù„Ç±„É¢„É≥Âêç</label>
        <input type="text" id="p-name" placeholder="‰æã: „É©„Ç§„ÉÅ„É•„Ç¶">

        <label>ÊÄßÊ†º</label>
        <select id="p-nature" onchange="updateNaturePreview()"></select>
        <div id="nature-preview" style="font-size:0.8rem; margin-top:4px; min-height:1em;"></div>

        <label>È£üÊùê (Lv1 / 30 / 60)</label>
        <div class="row-3">
            <select id="ing-1" class="ing-select"></select>
            <select id="ing-30" class="ing-select"></select>
            <select id="ing-60" class="ing-select"></select>
        </div>

        <label>„Çµ„Éñ„Çπ„Ç≠„É´</label>
        <div class="subskill-grid">
            <div class="subskill-group"><label>Lv10</label><select class="subskill-select"></select></div>
            <div class="subskill-group"><label>Lv25</label><select class="subskill-select"></select></div>
            <div class="subskill-group"><label>Lv50</label><select class="subskill-select"></select></div>
            <div class="subskill-group"><label>Lv75</label><select class="subskill-select"></select></div>
            <div class="subskill-group"><label>Lv100</label><select class="subskill-select"></select></div>
        </div>

        <button class="btn btn-add" onclick="addPokemon()">„Éù„Ç±„É¢„É≥„ÇíÁôªÈå≤</button>
    </div>

    <div class="panel">
        <input type="text" id="search-box" placeholder="üîç ÂêçÂâç„Éª„Çπ„Ç≠„É´„ÉªÁµµÊñáÂ≠ó„ÅßÊ§úÁ¥¢..." onkeyup="loadPokemon()" style="margin-bottom:15px;">
        <div id="pokemon-list"></div>
    </div>

    <script>
        // È£üÊùê„Éá„Éº„Çø
        const INGREDIENTS = [
            {n:"„É™„É≥„Ç¥", e:"üçé"}, {n:"„Éü„É´„ÇØ", e:"ü•õ"}, {n:"Â§ßË±Ü", e:"ü´ò"}, {n:"„Éü„ÉÑ", e:"üçØ"},
            {n:"ËÇâ", e:"üå≠"}, {n:"„Ç∏„É≥„Ç∏„É£„Éº", e:"ü´ö"}, {n:"„Éà„Éû„Éà", e:"üçÖ"}, {n:"Âçµ", e:"ü•ö"},
            {n:"„Ç™„Ç§„É´", e:"ü´í"}, {n:"„Éù„ÉÜ„Éà", e:"ü•î"}, {n:"„Éè„Éº„Éñ", e:"üåø"}, {n:"„Ç≥„Éº„É≥", e:"üåΩ"},
            {n:"„Ç´„Ç´„Ç™", e:"üç´"}, {n:"„Ç≠„Éé„Ç≥", e:"üçÑ"}, {n:"„Éç„ÇÆ", e:"üå±"}, {n:"„Ç∑„ÉÉ„Éù", e:"üçñ"}, {n:"„Ç≥„Éº„Éí„Éº", e:"‚òï"}
        ];

        // ÊÄßÊ†º„Éá„Éº„Çø
        const NATURES = {
            "„Åæ„Åò„ÇÅ": {up: null, down: null}, "„Åå„Çì„Å∞„Çä„ÇÑ": {up: null, down: null}, "„Åô„Å™„Åä": {up: null, down: null}, "„Åç„Åæ„Åê„Çå": {up: null, down: null}, "„Å¶„Çå„ÇÑ": {up: null, down: null},
            "„Åï„Åø„Åó„Åå„Çä": {up: "„ÅäÊâã‰ºù„ÅÑ", down: "ÂÖÉÊ∞ó"}, "„ÅÑ„Åò„Å£„Å±„Çä": {up: "„ÅäÊâã‰ºù„ÅÑ", down: "È£üÊùê"}, "„ÇÑ„Çì„Å°„ÇÉ": {up: "„ÅäÊâã‰ºù„ÅÑ", down: "„Çπ„Ç≠„É´"}, "„ÇÜ„ÅÜ„Åã„Çì": {up: "„ÅäÊâã‰ºù„ÅÑ", down: "EXP"},
            "„Åö„Å∂„Å®„ÅÑ": {up: "ÂÖÉÊ∞ó", down: "„ÅäÊâã‰ºù„ÅÑ"}, "„Çè„Çì„Å±„Åè": {up: "ÂÖÉÊ∞ó", down: "È£üÊùê"}, "„ÅÆ„ÅÜ„Å¶„Çì„Åç": {up: "ÂÖÉÊ∞ó", down: "„Çπ„Ç≠„É´"}, "„ÅÆ„Çì„Åç": {up: "ÂÖÉÊ∞ó", down: "EXP"},
            "„Å≤„Åã„Åà„ÇÅ": {up: "È£üÊùê", down: "„ÅäÊâã‰ºù„ÅÑ"}, "„Åä„Å£„Å®„Çä": {up: "È£üÊùê", down: "ÂÖÉÊ∞ó"}, "„ÅÜ„Å£„Åã„Çä„ÇÑ": {up: "È£üÊùê", down: "„Çπ„Ç≠„É´"}, "„Çå„ÅÑ„Åõ„ÅÑ": {up: "È£üÊùê", down: "EXP"},
            "„Åä„Å†„ÇÑ„Åã": {up: "„Çπ„Ç≠„É´", down: "„ÅäÊâã‰ºù„ÅÑ"}, "„Åä„Å®„Å™„Åó„ÅÑ": {up: "„Çπ„Ç≠„É´", down: "ÂÖÉÊ∞ó"}, "„Åó„Çì„Å°„Çá„ÅÜ": {up: "„Çπ„Ç≠„É´", down: "È£üÊùê"}, "„Å™„Åæ„ÅÑ„Åç": {up: "„Çπ„Ç≠„É´", down: "EXP"},
            "„Åä„Åè„Å≥„Çá„ÅÜ": {up: "EXP", down: "„ÅäÊâã‰ºù„ÅÑ"}, "„Åõ„Å£„Åã„Å°": {up: "EXP", down: "ÂÖÉÊ∞ó"}, "„Çà„ÅÜ„Åç": {up: "EXP", down: "È£üÊùê"}, "„ÇÄ„Åò„ÇÉ„Åç": {up: "EXP", down: "„Çπ„Ç≠„É´"}
        };

        // „Çµ„Éñ„Çπ„Ç≠„É´ÂàÜÈ°ûÔºàËâ≤„Å®ÈÄ£ÂãïÔºâ
        const SKILLS_GOLD = ["„Åç„ÅÆ„Åø„ÅÆÊï∞S", "„Åä„Å¶„Å§„Å†„ÅÑ„Éú„Éº„Éä„Çπ", "Áù°Áú†EXP„Éú„Éº„Éä„Çπ", "„É™„Çµ„Éº„ÉÅEXP„Éú„Éº„Éä„Çπ", "„ÇÜ„ÇÅ„ÅÆ„Åã„Åë„Çâ„Éú„Éº„Éä„Çπ", "ÂÖÉÊ∞óÂõûÂæ©„Éú„Éº„Éä„Çπ"];
        const SKILLS_BLUE = ["„Åä„Å¶„Å§„Å†„ÅÑ„Çπ„Éî„Éº„ÉâM", "È£üÊùêÁ¢∫Áéá„Ç¢„ÉÉ„ÉóM", "„Çπ„Ç≠„É´Á¢∫Áéá„Ç¢„ÉÉ„ÉóM", "ÊúÄÂ§ßÊâÄÊåÅÊï∞„Ç¢„ÉÉ„ÉóL", "ÊúÄÂ§ßÊâÄÊåÅÊï∞„Ç¢„ÉÉ„ÉóM", "„Çπ„Ç≠„É´„É¨„Éô„É´„Ç¢„ÉÉ„ÉóM"];
        const SKILLS_WHITE = ["„Åä„Å¶„Å§„Å†„ÅÑ„Çπ„Éî„Éº„ÉâS", "È£üÊùêÁ¢∫Áéá„Ç¢„ÉÉ„ÉóS", "„Çπ„Ç≠„É´Á¢∫Áéá„Ç¢„ÉÉ„ÉóS", "ÊúÄÂ§ßÊâÄÊåÅÊï∞„Ç¢„ÉÉ„ÉóS", "„Çπ„Ç≠„É´„É¨„Éô„É´„Ç¢„ÉÉ„ÉóS"];

        document.addEventListener('DOMContentLoaded', () => {
            initSelects();
            loadPokemon();
        });

        function initSelects() {
            // ÊÄßÊ†º
            const natureSel = document.getElementById('p-nature');
            Object.keys(NATURES).forEach(n => natureSel.add(new Option(n, n)));
            natureSel.value = "„ÅÑ„Åò„Å£„Å±„Çä";
            updateNaturePreview();

            // È£üÊùê
            document.querySelectorAll('.ing-select').forEach(sel => {
                sel.add(new Option("---", ""));
                INGREDIENTS.forEach(i => sel.add(new Option(`${i.e} ${i.n}`, i.e)));
            });

            // „Çµ„Éñ„Çπ„Ç≠„É´ („Åì„Åì„Åß„É´„Éº„Éó„ÅÆ‰∏çÂÇô„Çí‰øÆÊ≠£)
            document.querySelectorAll('.subskill-select').forEach(sel => {
                sel.add(new Option("---", ""));
                
                const grpG = document.createElement('optgroup'); grpG.label = "Èáë„Çπ„Ç≠„É´";
                SKILLS_GOLD.forEach(s => grpG.appendChild(new Option(s, s)));
                sel.appendChild(grpG);

                const grpB = document.createElement('optgroup'); grpB.label = "Èùí„Çπ„Ç≠„É´";
                SKILLS_BLUE.forEach(s => grpB.appendChild(new Option(s, s)));
                sel.appendChild(grpB);

                const grpW = document.createElement('optgroup'); grpW.label = "ÁôΩ„Çπ„Ç≠„É´";
                SKILLS_WHITE.forEach(s => grpW.appendChild(new Option(s, s)));
                sel.appendChild(grpW);
            });
        }

        function updateNaturePreview() {
            const d = NATURES[document.getElementById('p-nature').value];
            document.getElementById('nature-preview').innerHTML = d.up ? `<span class="nature-up">‚ñ≤${d.up}</span> <span class="nature-down">‚ñº${d.down}</span>` : "Ë£úÊ≠£„Å™„Åó";
        }

        function addPokemon() {
            const name = document.getElementById('p-name').value;
            if (!name) return alert("ÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ");
            const skills = Array.from(document.querySelectorAll('.subskill-select')).map(s => s.value);
            const ings = Array.from(document.querySelectorAll('.ing-select')).map(s => s.value);
            
            const list = getList();
            list.push({ id: Date.now(), name, nature: document.getElementById('p-nature').value, ingredients: ings, subskills: skills });
            saveList(list);
            
            // ÂÖ•Âäõ„É™„Çª„ÉÉ„Éà
            document.getElementById('p-name').value = "";
            loadPokemon();
        }

        function getList() { return JSON.parse(localStorage.getItem('pokeSleepData')) || []; }
        function saveList(list) { localStorage.setItem('pokeSleepData', JSON.stringify(list)); }

        function loadPokemon() {
            const container = document.getElementById('pokemon-list');
            container.innerHTML = "";
            const search = document.getElementById('search-box').value.toLowerCase();
            
            getList().reverse().filter(p => (p.name + p.ingredients.join('') + p.subskills.join('')).toLowerCase().includes(search)).forEach(p => {
                const card = document.createElement('div');
                card.className = `card ${p.subskills.includes("„Åç„ÅÆ„Åø„ÅÆÊï∞S") ? 'has-gold' : ''}`;
                
                const n = NATURES[p.nature];
                const natureText = n.up ? `<span class="nature-up">‚ñ≤${n.up[0]}</span><span class="nature-down">‚ñº${n.down[0]}</span>` : '--';

                card.innerHTML = `
                    <div class="card-header">
                        <span class="card-title">${p.name}</span>
                        <button class="btn-del" onclick="deletePokemon(${p.id})">√ó</button>
                    </div>
                    <div class="info-row">
                        <span style="font-weight:bold; color:#555;">${p.nature} ${natureText}</span>
                        <div class="ing-emoji-list">${p.ingredients.join('')}</div>
                    </div>
                    <div class="skills-list">
                        ${p.subskills.map(s => {
                            if(!s) return '';
                            let cls = "skill-tag";
                            if(SKILLS_GOLD.includes(s)) cls += " skill-gold";
                            else if(SKILLS_BLUE.includes(s)) cls += " skill-blue";
                            return `<span class="${cls}">${s}</span>`;
                        }).join('')}
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function deletePokemon(id) {
            if(confirm('ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                saveList(getList().filter(p => p.id !== id));
                loadPokemon();
            }
        }

        function exportData() {
            const blob = new Blob([JSON.stringify(getList(), null, 2)], {type: "application/json"});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `pokesleep_data_${new Date().toISOString().slice(0,10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importData(input) {
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    saveList(data);
                    loadPokemon();
                    alert("Ë™≠ËæºÂÆå‰∫Ü");
                } catch(err) { alert("„Ç®„É©„Éº: " + err); }
            };
            reader.readAsText(input.files[0]);
            input.value = "";
        }
    </script>
</body>
</html>
