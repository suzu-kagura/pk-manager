<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒã‚±ã‚¹ãƒªå³é¸ç®¡ç†ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼</title>
    <style>
        :root {
            --primary: #4a90e2;
            --bg: #f0f4f8;
            --card-bg: #ffffff;
            --danger: #ff6b6b;
            --gold-skill: #ffd700;
            --blue-skill: #87ceeb;
            --text-dark: #333;
        }
        body { font-family: "Helvetica Neue", Arial, sans-serif; max-width: 900px; margin: 0 auto; padding: 20px; background-color: var(--bg); color: var(--text-dark); }
        h1 { text-align: center; color: #2c3e50; margin-bottom: 20px; }

        /* ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        .container { display: grid; gap: 20px; }
        .panel { background: var(--card-bg); padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }

        /* ãƒ•ã‚©ãƒ¼ãƒ è¦ç´  */
        label { font-weight: bold; display: block; margin-top: 10px; font-size: 0.9rem; }
        input, select { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 1rem; }
        
        /* ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆé£Ÿæãƒ»ã‚µãƒ–ã‚¹ã‚­ãƒ«ç”¨ï¼‰ */
        .row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        .row-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .subskill-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 8px; }

        /* ãƒœã‚¿ãƒ³ */
        .btn { border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 1rem; font-weight: bold; transition: opacity 0.2s; width: 100%; margin-top: 15px; }
        .btn-add { background-color: #2ecc71; color: white; }
        .btn-dl { background-color: var(--primary); color: white; }
        .btn-imp { background-color: #9b59b6; color: white; }
        .btn-del { background-color: var(--danger); color: white; width: auto; padding: 5px 12px; font-size: 0.8rem; margin-top: 0;}
        .btn:hover { opacity: 0.9; }

        /* ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒªã‚¢ */
        .io-actions { display: flex; gap: 10px; margin-bottom: 20px; }
        #file-input { display: none; }

        /* ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚¨ãƒªã‚¢ */
        .filter-area { margin-bottom: 15px; }

        /* ãƒªã‚¹ãƒˆã‚«ãƒ¼ãƒ‰ */
        .card { background: white; border-radius: 8px; padding: 15px; margin-bottom: 15px; border-left: 6px solid #ccc; box-shadow: 0 2px 4px rgba(0,0,0,0.05); position: relative; }
        /* ãã®ã¿SæŒã¡ãªã©ã¯æ ç·šã‚’é‡‘è‰²ã« */
        .card.has-gold { border-left-color: var(--gold-skill); }
        
        .card-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 8px; margin-bottom: 8px; }
        .card-title { font-size: 1.2rem; font-weight: bold; }
        .card-sp { font-size: 0.9rem; color: #666; background: #eee; padding: 2px 8px; border-radius: 10px; }
        
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.9rem; }
        .info-label { color: #888; font-size: 0.8rem; }
        
        .nature-up { color: #e74c3c; font-weight: bold; } /* ä¸Šæ˜‡è£œæ­£ã¯èµ¤ */
        .nature-down { color: #3498db; font-weight: bold; } /* ä¸‹é™è£œæ­£ã¯é’ */

        .ingredients-display { display: flex; gap: 5px; }
        .ing-icon { background: #f9f9f9; border: 1px solid #eee; padding: 2px 6px; border-radius: 4px; font-size: 0.85rem; }

        .skills-list { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 8px; }
        .skill-tag { padding: 3px 8px; border-radius: 4px; font-size: 0.8rem; background: #eee; }
        .skill-gold { background: #fff59d; border: 1px solid #fbc02d; color: #5f4306; font-weight: bold;}
        .skill-blue { background: #e1f5fe; border: 1px solid #4fc3f7; color: #0277bd; }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        @media (max-width: 600px) {
            .row-3, .row-2 { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <h1>ğŸ˜´ ãƒã‚±ã‚¹ãƒªå³é¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼</h1>

    <div class="container">
        <div class="io-actions">
            <button class="btn btn-dl" onclick="exportData()">ğŸ’¾ ä¿å­˜ (Export)</button>
            <button class="btn btn-imp" onclick="document.getElementById('file-input').click()">ğŸ“‚ èª­è¾¼ (Import)</button>
            <input type="file" id="file-input" accept=".json" onchange="importData(this)">
        </div>

        <div class="panel">
            <div class="row-2">
                <div>
                    <label>ãƒã‚±ãƒ¢ãƒ³å</label>
                    <input type="text" id="p-name" placeholder="ä¾‹: ãƒ©ã‚¤ãƒãƒ¥ã‚¦">
                </div>
                <div>
                    <label>SP</label>
                    <input type="number" id="p-sp" placeholder="1200">
                </div>
            </div>

            <label>æ€§æ ¼ï¼ˆè£œæ­£ã‚’è‡ªå‹•è¡¨ç¤ºï¼‰</label>
            <select id="p-nature" onchange="updateNaturePreview()"></select>
            <div id="nature-preview" style="font-size:0.85rem; margin-top:4px; color:#666; height: 1.2em;"></div>

            <label>é£Ÿæ (Lv1 / Lv30 / Lv60)</label>
            <div class="row-3">
                <select id="ing-1"></select>
                <select id="ing-30"></select>
                <select id="ing-60"></select>
            </div>

            <label>ã‚µãƒ–ã‚¹ã‚­ãƒ« (Lv10, 25, 50, 75, 100)</label>
            <div class="subskill-grid">
                <input type="text" class="subskill-input" placeholder="Lv10">
                <input type="text" class="subskill-input" placeholder="Lv25">
                <input type="text" class="subskill-input" placeholder="Lv50">
                <input type="text" class="subskill-input" placeholder="Lv75">
                <input type="text" class="subskill-input" placeholder="Lv100">
            </div>

            <button class="btn btn-add" onclick="addPokemon()">ãƒã‚±ãƒ¢ãƒ³ã‚’ç™»éŒ²</button>
        </div>

        <div class="panel">
            <div class="filter-area">
                <input type="text" id="search-box" placeholder="ğŸ” åå‰ã‚„ã‚¹ã‚­ãƒ«ã§æ¤œç´¢..." onkeyup="loadPokemon()">
            </div>
            <div id="pokemon-list"></div>
        </div>
    </div>

    <script>
        // --- ãƒ‡ãƒ¼ã‚¿å®šç¾© ---
        const INGREDIENTS = ["ã‚Šã‚“ã”", "ãƒŸãƒ«ã‚¯", "å¤§è±†", "ãƒŸãƒ„", "è‚‰", "ã‚¸ãƒ³ã‚¸ãƒ£ãƒ¼", "ãƒˆãƒãƒˆ", "åµ", "ã‚ªã‚¤ãƒ«", "ãƒãƒ†ãƒˆ", "ãƒãƒ¼ãƒ–", "ã‚³ãƒ¼ãƒ³", "ã‚«ã‚«ã‚ª", "ãã®ã“", "ãƒã‚®", "ã—ã£ã½", "ã‚³ãƒ¼ãƒ’ãƒ¼"];
        
        const NATURES = {
            "ã¾ã˜ã‚": {up: null, down: null}, "ãŒã‚“ã°ã‚Šã‚„": {up: null, down: null}, "ã™ãªãŠ": {up: null, down: null}, "ãã¾ãã‚Œ": {up: null, down: null}, "ã¦ã‚Œã‚„": {up: null, down: null},
            "ã•ã¿ã—ãŒã‚Š": {up: "ãŠæ‰‹ä¼ã„", down: "å…ƒæ°—"}, "ã„ã˜ã£ã±ã‚Š": {up: "ãŠæ‰‹ä¼ã„", down: "é£Ÿæ"}, "ã‚„ã‚“ã¡ã‚ƒ": {up: "ãŠæ‰‹ä¼ã„", down: "ã‚¹ã‚­ãƒ«"}, "ã‚†ã†ã‹ã‚“": {up: "ãŠæ‰‹ä¼ã„", down: "EXP"},
            "ãšã¶ã¨ã„": {up: "å…ƒæ°—", down: "ãŠæ‰‹ä¼ã„"}, "ã‚ã‚“ã±ã": {up: "å…ƒæ°—", down: "é£Ÿæ"}, "ã®ã†ã¦ã‚“ã": {up: "å…ƒæ°—", down: "ã‚¹ã‚­ãƒ«"}, "ã®ã‚“ã": {up: "å…ƒæ°—", down: "EXP"},
            "ã²ã‹ãˆã‚": {up: "é£Ÿæ", down: "ãŠæ‰‹ä¼ã„"}, "ãŠã£ã¨ã‚Š": {up: "é£Ÿæ", down: "å…ƒæ°—"}, "ã†ã£ã‹ã‚Šã‚„": {up: "é£Ÿæ", down: "ã‚¹ã‚­ãƒ«"}, "ã‚Œã„ã›ã„": {up: "é£Ÿæ", down: "EXP"},
            "ãŠã ã‚„ã‹": {up: "ã‚¹ã‚­ãƒ«", down: "ãŠæ‰‹ä¼ã„"}, "ãŠã¨ãªã—ã„": {up: "ã‚¹ã‚­ãƒ«", down: "å…ƒæ°—"}, "ã—ã‚“ã¡ã‚‡ã†": {up: "ã‚¹ã‚­ãƒ«", down: "é£Ÿæ"}, "ãªã¾ã„ã": {up: "ã‚¹ã‚­ãƒ«", down: "EXP"},
            "ãŠãã³ã‚‡ã†": {up: "EXP", down: "ãŠæ‰‹ä¼ã„"}, "ã›ã£ã‹ã¡": {up: "EXP", down: "å…ƒæ°—"}, "ã‚ˆã†ã": {up: "EXP", down: "é£Ÿæ"}, "ã‚€ã˜ã‚ƒã": {up: "EXP", down: "ã‚¹ã‚­ãƒ«"}
        };

        // è‰²ä»˜ã‘ã™ã‚‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
        const GOLD_SKILLS = ["ãã®ã¿S", "ãŠã¦ã¤ã ã„ãƒœãƒ¼ãƒŠã‚¹", "ç¡çœ EXPãƒœãƒ¼ãƒŠã‚¹", "ãƒªã‚µãƒ¼ãƒEXPãƒœãƒ¼ãƒŠã‚¹", "ã‚†ã‚ã®ã‹ã‘ã‚‰ãƒœãƒ¼ãƒŠã‚¹", "å…ƒæ°—å›å¾©ãƒœãƒ¼ãƒŠã‚¹"];
        const BLUE_SKILLS = ["ãŠã¦ã¤ã ã„ã‚¹ãƒ”ãƒ¼ãƒ‰M", "é£Ÿæç¢ºç‡ã‚¢ãƒƒãƒ—M", "ã‚¹ã‚­ãƒ«ç¢ºç‡ã‚¢ãƒƒãƒ—M", "æœ€å¤§æ‰€æŒæ•°ã‚¢ãƒƒãƒ—L", "ã‚¹ã‚­ãƒ«ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—M", "ã‚¹ã‚­ãƒ«ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—S"]; // Mç³»ãªã©

        // --- åˆæœŸåŒ–å‡¦ç† ---
        document.addEventListener('DOMContentLoaded', () => {
            initSelects();
            loadPokemon();
        });

        function initSelects() {
            // æ€§æ ¼ã®ç”Ÿæˆ
            const natureSel = document.getElementById('p-nature');
            Object.keys(NATURES).forEach(n => {
                const opt = document.createElement('option');
                opt.value = n;
                opt.textContent = n;
                natureSel.appendChild(opt);
            });
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š
            natureSel.value = "ã„ã˜ã£ã±ã‚Š";
            updateNaturePreview();

            // é£Ÿæã®ç”Ÿæˆ
            const createIngOpt = (id) => {
                const sel = document.getElementById(id);
                sel.innerHTML = '<option value="">æœªå®š</option>';
                INGREDIENTS.forEach(ing => {
                    const opt = document.createElement('option');
                    opt.value = ing;
                    opt.textContent = ing;
                    sel.appendChild(opt);
                });
            };
            createIngOpt('ing-1');
            createIngOpt('ing-30');
            createIngOpt('ing-60');
        }

        function updateNaturePreview() {
            const val = document.getElementById('p-nature').value;
            const data = NATURES[val];
            const div = document.getElementById('nature-preview');
            if (data && data.up) {
                div.innerHTML = `<span class="nature-up">â–² ${data.up}</span> / <span class="nature-down">â–¼ ${data.down}</span>`;
            } else {
                div.textContent = "è£œæ­£ãªã—";
            }
        }

        // --- CRUDæ“ä½œ ---
        function addPokemon() {
            const name = document.getElementById('p-name').value;
            if (!name) return alert("ãƒã‚±ãƒ¢ãƒ³åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");

            // ã‚µãƒ–ã‚¹ã‚­ãƒ«å…¥åŠ›ã®åé›†
            const skillInputs = document.querySelectorAll('.subskill-input');
            const skills = Array.from(skillInputs).map(input => input.value.trim());

            const pokemon = {
                id: Date.now(),
                name: name,
                sp: document.getElementById('p-sp').value,
                nature: document.getElementById('p-nature').value,
                ingredients: [
                    document.getElementById('ing-1').value,
                    document.getElementById('ing-30').value,
                    document.getElementById('ing-60').value
                ],
                subskills: skills,
                createdAt: new Date().toISOString()
            };

            let list = getList();
            list.push(pokemon);
            saveList(list);
            
            // ãƒ•ã‚©ãƒ¼ãƒ ã‚¯ãƒªã‚¢
            document.getElementById('p-name').value = "";
            document.getElementById('p-sp').value = "";
            skillInputs.forEach(i => i.value = "");
            
            loadPokemon();
        }

        function getList() {
            return JSON.parse(localStorage.getItem('pokeSleepFull')) || [];
        }

        function saveList(list) {
            localStorage.setItem('pokeSleepFull', JSON.stringify(list));
        }

        function deletePokemon(id) {
            if(!confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
            let list = getList();
            list = list.filter(p => p.id !== id);
            saveList(list);
            loadPokemon();
        }

        // --- è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯ ---
        function loadPokemon() {
            const container = document.getElementById('pokemon-list');
            container.innerHTML = "";
            
            const searchText = document.getElementById('search-box').value.toLowerCase();
            const list = getList();

            // é€†é †ï¼ˆæ–°ã—ã„é †ï¼‰ã«ã—ã¦ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
            const filtered = list.reverse().filter(p => {
                const searchTarget = (p.name + p.subskills.join(' ')).toLowerCase();
                return searchTarget.includes(searchText);
            });

            filtered.forEach(p => {
                const hasKinomiS = p.subskills.some(s => s.includes("ãã®ã¿S"));
                const card = document.createElement('div');
                card.className = `card ${hasKinomiS ? 'has-gold' : ''}`;

                // æ€§æ ¼ãƒ‡ãƒ¼ã‚¿ã®å–å¾—
                const nData = NATURES[p.nature] || {up:null, down:null};
                const natureDisplay = nData.up 
                    ? `<span class="nature-up">â–²${nData.up}</span> <span class="nature-down">â–¼${nData.down}</span>` 
                    : `<span>è£œæ­£ãªã—</span>`;

                // ã‚¹ã‚­ãƒ«ã®HTMLç”Ÿæˆ
                let skillsHtml = "";
                p.subskills.forEach((s, idx) => {
                    if(!s) return;
                    let cls = "skill-tag";
                    // éƒ¨åˆ†ä¸€è‡´ã§åˆ¤å®šï¼ˆ"ãŠã¦ã¤ã ã„ãƒœãƒ¼ãƒŠã‚¹"ãªã©ãŒå«ã¾ã‚Œã¦ã„ã‚Œã°ï¼‰
                    if (GOLD_SKILLS.some(g => s.includes(g))) cls += " skill-gold";
                    else if (BLUE_SKILLS.some(b => s.includes(b))) cls += " skill-blue";
                    
                    const lvLabel = [10, 25, 50, 75, 100][idx];
                    skillsHtml += `<span class="${cls}">${lvLabel}:${s}</span>`;
                });

                card.innerHTML = `
                    <div class="card-header">
                        <span class="card-title">${p.name}</span>
                        <div>
                            <span class="card-sp">SP: ${p.sp || '-'}</span>
                            <button class="btn btn-del" onclick="deletePokemon(${p.id})">å‰Šé™¤</button>
                        </div>
                    </div>
                    
                    <div class="info-grid">
                        <div>
                            <div class="info-label">æ€§æ ¼: ${p.nature}</div>
                            <div>${natureDisplay}</div>
                        </div>
                        <div>
                            <div class="info-label">é£Ÿæ</div>
                            <div class="ingredients-display">
                                ${p.ingredients.map(i => i ? `<span class="ing-icon">${i}</span>` : '').join('')}
                            </div>
                        </div>
                    </div>

                    <div style="margin-top:10px;">
                        <div class="info-label">ã‚µãƒ–ã‚¹ã‚­ãƒ«</div>
                        <div class="skills-list">${skillsHtml}</div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // --- ã‚¤ãƒ³ãƒãƒ¼ãƒˆ/ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ ---
        function exportData() {
            const list = getList();
            const dataStr = JSON.stringify(list, null, 2);
            const blob = new Blob([dataStr], {type: "application/json"});
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `pokesleep_data_${new Date().toISOString().slice(0,10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importData(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const json = JSON.parse(e.target.result);
                    if (!Array.isArray(json)) throw new Error("ç„¡åŠ¹ãªãƒ‡ãƒ¼ã‚¿å½¢å¼ã§ã™");
                    
                    if(confirm(`ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¸Šæ›¸ãã—ã€${json.length}ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã™ã‹ï¼Ÿ`)) {
                        saveList(json);
                        loadPokemon();
                        alert("èª­ã¿è¾¼ã¿å®Œäº†ã—ã¾ã—ãŸï¼");
                    }
                } catch (err) {
                    alert("ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: " + err.message);
                }
                // inputã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦åŒã˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å†é¸æŠã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
                input.value = '';
            };
            reader.readAsText(file);
        }
    </script>
</body>
</html>
