<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒã‚±ã‚¹ãƒªå³é¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼</title>
    <style>
        :root {
            --primary: #4a90e2;
            --bg: #f0f4f8;
            --card-bg: #ffffff;
            --danger: #ff6b6b;
            --gold-skill: #ffd700;
            --blue-skill: #87ceeb;
            --white-skill: #f0f0f0;
            --text-dark: #333;
        }
        body { font-family: "Helvetica Neue", Arial, sans-serif; max-width: 900px; margin: 0 auto; padding: 20px; background-color: var(--bg); color: var(--text-dark); }
        h1 { text-align: center; color: #2c3e50; margin-bottom: 20px; }

        /* ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        .container { display: grid; gap: 20px; }
        .panel { background: var(--card-bg); padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }

        /* ãƒ•ã‚©ãƒ¼ãƒ è¦ç´  */
        label { font-weight: bold; display: block; margin-top: 15px; font-size: 0.9rem; margin-bottom: 5px; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 1rem; background-color: #fff; }
        
        /* ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        .row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        .subskill-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; }
        
        /* ã‚µãƒ–ã‚¹ã‚­ãƒ«é¸æŠã®ãƒ©ãƒ™ãƒ«(Lvè¡¨ç¤º) */
        .subskill-group label { margin-top: 0; font-size: 0.8rem; color: #666; }

        /* ãƒœã‚¿ãƒ³ */
        .btn { border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 1rem; font-weight: bold; transition: opacity 0.2s; width: 100%; margin-top: 20px; }
        .btn-add { background-color: #2ecc71; color: white; }
        .btn-dl { background-color: var(--primary); color: white; }
        .btn-imp { background-color: #9b59b6; color: white; }
        .btn-del { background-color: var(--danger); color: white; width: auto; padding: 5px 12px; font-size: 0.8rem; margin-top: 0;}
        .btn:hover { opacity: 0.9; }

        /* ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒªã‚¢ */
        .io-actions { display: flex; gap: 10px; margin-bottom: 20px; }
        #file-input { display: none; }

        /* ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚¨ãƒªã‚¢ */
        .filter-area { margin-bottom: 15px; }

        /* ãƒªã‚¹ãƒˆã‚«ãƒ¼ãƒ‰ */
        .card { background: white; border-radius: 8px; padding: 15px; margin-bottom: 15px; border-left: 6px solid #ccc; box-shadow: 0 2px 4px rgba(0,0,0,0.05); position: relative; }
        .card.has-gold { border-left-color: var(--gold-skill); }
        
        .card-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 8px; margin-bottom: 8px; }
        .card-title { font-size: 1.2rem; font-weight: bold; }
        
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.9rem; }
        .info-label { color: #888; font-size: 0.8rem; }
        
        .nature-up { color: #e74c3c; font-weight: bold; }
        .nature-down { color: #3498db; font-weight: bold; }

        .ingredients-display { display: flex; gap: 5px; flex-wrap: wrap; }
        .ing-badge { background: #f9f9f9; border: 1px solid #eee; padding: 2px 6px; border-radius: 4px; font-size: 0.9rem; }

        .skills-list { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 8px; }
        .skill-tag { padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; background: var(--white-skill); border: 1px solid #ddd; }
        .skill-gold { background: #fff9c4; border: 1px solid #fbc02d; color: #5f4306; font-weight: bold;}
        .skill-blue { background: #e1f5fe; border: 1px solid #4fc3f7; color: #0277bd; }

        @media (max-width: 600px) {
            .row-3 { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <h1>ğŸ˜´ ãƒã‚±ã‚¹ãƒªå³é¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼</h1>

    <div class="container">
        <div class="io-actions">
            <button class="btn btn-dl" onclick="exportData()">ğŸ’¾ ä¿å­˜ (Export)</button>
            <button class="btn btn-imp" onclick="document.getElementById('file-input').click()">ğŸ“‚ èª­è¾¼ (Import)</button>
            <input type="file" id="file-input" accept=".json" onchange="importData(this)">
        </div>

        <div class="panel">
            <label>ãƒã‚±ãƒ¢ãƒ³å</label>
            <input type="text" id="p-name" placeholder="ä¾‹: ãƒ©ã‚¤ãƒãƒ¥ã‚¦">

            <label>æ€§æ ¼ï¼ˆè£œæ­£ã‚’è‡ªå‹•è¡¨ç¤ºï¼‰</label>
            <select id="p-nature" onchange="updateNaturePreview()"></select>
            <div id="nature-preview" style="font-size:0.85rem; margin-top:4px; color:#666; height: 1.2em;"></div>

            <label>é£Ÿææ§‹æˆ (Lv1 / Lv30 / Lv60)</label>
            <div class="row-3">
                <select id="ing-1" class="ing-select"></select>
                <select id="ing-30" class="ing-select"></select>
                <select id="ing-60" class="ing-select"></select>
            </div>

            <label>ã‚µãƒ–ã‚¹ã‚­ãƒ«</label>
            <div class="subskill-grid">
                <div class="subskill-group"><label>Lv10</label><select class="subskill-select"></select></div>
                <div class="subskill-group"><label>Lv25</label><select class="subskill-select"></select></div>
                <div class="subskill-group"><label>Lv50</label><select class="subskill-select"></select></div>
                <div class="subskill-group"><label>Lv75</label><select class="subskill-select"></select></div>
                <div class="subskill-group"><label>Lv100</label><select class="subskill-select"></select></div>
            </div>

            <button class="btn btn-add" onclick="addPokemon()">ãƒã‚±ãƒ¢ãƒ³ã‚’ç™»éŒ²</button>
        </div>

        <div class="panel">
            <div class="filter-area">
                <input type="text" id="search-box" placeholder="ğŸ” åå‰ã‚„ã‚¹ã‚­ãƒ«ã§æ¤œç´¢..." onkeyup="loadPokemon()">
            </div>
            <div id="pokemon-list"></div>
        </div>
    </div>

    <script>
        // --- å®šæ•°å®šç¾© ---
        
        // é£Ÿæï¼ˆçµµæ–‡å­—ä»˜ãï¼‰
        const INGREDIENTS = [
            "ğŸ ç‰¹é¸ãƒªãƒ³ã‚´", "ğŸ¥› ãƒ¢ãƒ¼ãƒ¢ãƒ¼ãƒŸãƒ«ã‚¯", "ğŸ«˜ ãƒ¯ã‚«ã‚¯ã‚µå¤§è±†", "ğŸ¯ ã‚ã¾ã„ãƒŸãƒ„", 
            "ğŸŒ­ ãƒãƒ¡ãƒŸãƒ¼ãƒˆ", "ğŸ«š ã‚ã£ãŸã‹ã‚¸ãƒ³ã‚¸ãƒ£ãƒ¼", "ğŸ… ã‚ã‚“ã¿ã‚“ãƒˆãƒãƒˆ", "ğŸ¥š ã¨ãã›ã‚“ã‚¨ãƒƒã‚°", 
            "ğŸ«’ ãƒ”ãƒ¥ã‚¢ãªã‚ªã‚¤ãƒ«", "ğŸ¥” ã»ã£ã“ã‚Šãƒãƒ†ãƒˆ", "ğŸŒ¿ ã’ãã‹ã‚‰ãƒãƒ¼ãƒ–", "ğŸŒ½ ãƒ¯ã‚«ã‚¯ã‚µã‚³ãƒ¼ãƒ³", 
            "ğŸ« ãƒªãƒ©ãƒƒã‚¯ã‚¹ã‚«ã‚«ã‚ª", "ğŸ„ ã‚ã˜ã‚ã„ã‚­ãƒã‚³", "ğŸŒ± ãµã¨ã„ãªãŒã­ã", "ğŸ– ãŠã„ã—ã„ã‚·ãƒƒãƒ", "â˜• ã‚ã–ã¾ã—ã‚³ãƒ¼ãƒ’ãƒ¼"
        ];

        // æ€§æ ¼ãƒ‡ãƒ¼ã‚¿
        const NATURES = {
            "ã¾ã˜ã‚": {up: null, down: null}, "ãŒã‚“ã°ã‚Šã‚„": {up: null, down: null}, "ã™ãªãŠ": {up: null, down: null}, "ãã¾ãã‚Œ": {up: null, down: null}, "ã¦ã‚Œã‚„": {up: null, down: null},
            "ã•ã¿ã—ãŒã‚Š": {up: "ãŠæ‰‹ä¼ã„", down: "å…ƒæ°—"}, "ã„ã˜ã£ã±ã‚Š": {up: "ãŠæ‰‹ä¼ã„", down: "é£Ÿæ"}, "ã‚„ã‚“ã¡ã‚ƒ": {up: "ãŠæ‰‹ä¼ã„", down: "ã‚¹ã‚­ãƒ«"}, "ã‚†ã†ã‹ã‚“": {up: "ãŠæ‰‹ä¼ã„", down: "EXP"},
            "ãšã¶ã¨ã„": {up: "å…ƒæ°—", down: "ãŠæ‰‹ä¼ã„"}, "ã‚ã‚“ã±ã": {up: "å…ƒæ°—", down: "é£Ÿæ"}, "ã®ã†ã¦ã‚“ã": {up: "å…ƒæ°—", down: "ã‚¹ã‚­ãƒ«"}, "ã®ã‚“ã": {up: "å…ƒæ°—", down: "EXP"},
            "ã²ã‹ãˆã‚": {up: "é£Ÿæ", down: "ãŠæ‰‹ä¼ã„"}, "ãŠã£ã¨ã‚Š": {up: "é£Ÿæ", down: "å…ƒæ°—"}, "ã†ã£ã‹ã‚Šã‚„": {up: "é£Ÿæ", down: "ã‚¹ã‚­ãƒ«"}, "ã‚Œã„ã›ã„": {up: "é£Ÿæ", down: "EXP"},
            "ãŠã ã‚„ã‹": {up: "ã‚¹ã‚­ãƒ«", down: "ãŠæ‰‹ä¼ã„"}, "ãŠã¨ãªã—ã„": {up: "ã‚¹ã‚­ãƒ«", down: "å…ƒæ°—"}, "ã—ã‚“ã¡ã‚‡ã†": {up: "ã‚¹ã‚­ãƒ«", down: "é£Ÿæ"}, "ãªã¾ã„ã": {up: "ã‚¹ã‚­ãƒ«", down: "EXP"},
            "ãŠãã³ã‚‡ã†": {up: "EXP", down: "ãŠæ‰‹ä¼ã„"}, "ã›ã£ã‹ã¡": {up: "EXP", down: "å…ƒæ°—"}, "ã‚ˆã†ã": {up: "EXP", down: "é£Ÿæ"}, "ã‚€ã˜ã‚ƒã": {up: "EXP", down: "ã‚¹ã‚­ãƒ«"}
        };

        // ã‚µãƒ–ã‚¹ã‚­ãƒ«ãƒªã‚¹ãƒˆï¼ˆè‰²åˆ¤å®šç”¨ï¼‰
        const SKILLS_GOLD = ["ãã®ã¿ã®æ•°S", "ãŠã¦ã¤ã ã„ãƒœãƒ¼ãƒŠã‚¹", "ç¡çœ EXPãƒœãƒ¼ãƒŠã‚¹", "ãƒªã‚µãƒ¼ãƒEXPãƒœãƒ¼ãƒŠã‚¹", "ã‚†ã‚ã®ã‹ã‘ã‚‰ãƒœãƒ¼ãƒŠã‚¹", "å…ƒæ°—å›å¾©ãƒœãƒ¼ãƒŠã‚¹"];
        const SKILLS_BLUE = ["ãŠã¦ã¤ã ã„ã‚¹ãƒ”ãƒ¼ãƒ‰M", "é£Ÿæç¢ºç‡ã‚¢ãƒƒãƒ—M", "ã‚¹ã‚­ãƒ«ç¢ºç‡ã‚¢ãƒƒãƒ—M", "æœ€å¤§æ‰€æŒæ•°ã‚¢ãƒƒãƒ—L", "ã‚¹ã‚­ãƒ«ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—M", "ã‚¹ã‚­ãƒ«ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—S"];
        const SKILLS_WHITE = ["ãŠã¦ã¤ã ã„ã‚¹ãƒ”ãƒ¼ãƒ‰S", "é£Ÿæç¢ºç‡ã‚¢ãƒƒãƒ—S", "ã‚¹ã‚­ãƒ«ç¢ºç‡ã‚¢ãƒƒãƒ—S", "æœ€å¤§æ‰€æŒæ•°ã‚¢ãƒƒãƒ—M", "æœ€å¤§æ‰€æŒæ•°ã‚¢ãƒƒãƒ—S"];

        // å…¨ã‚¹ã‚­ãƒ«ãƒªã‚¹ãƒˆï¼ˆé¸æŠè‚¢è¡¨ç¤ºç”¨ï¼‰
        const ALL_SKILLS = [...SKILLS_GOLD, ...SKILLS_BLUE, ...SKILLS_WHITE].sort();

        // --- åˆæœŸåŒ– ---
        document.addEventListener('DOMContentLoaded', () => {
            initSelects();
            loadPokemon();
        });

        function initSelects() {
            // æ€§æ ¼è¨­å®š
            const natureSel = document.getElementById('p-nature');
            Object.keys(NATURES).forEach(n => {
                const opt = document.createElement('option');
                opt.value = n;
                opt.textContent = n;
                natureSel.appendChild(opt);
            });
            natureSel.value = "ã„ã˜ã£ã±ã‚Š";
            updateNaturePreview();

            // é£Ÿæè¨­å®š
            const ingSelects = document.querySelectorAll('.ing-select');
            ingSelects.forEach(sel => {
                sel.innerHTML = '<option value="">æœªé–‹æ”¾/ä¸æ˜</option>';
                INGREDIENTS.forEach(ing => {
                    const opt = document.createElement('option');
                    opt.value = ing;
                    opt.textContent = ing;
                    sel.appendChild(opt);
                });
            });

            // ã‚µãƒ–ã‚¹ã‚­ãƒ«è¨­å®š
            const subSelects = document.querySelectorAll('.subskill-select');
            subSelects.forEach(sel => {
                sel.innerHTML = '<option value="">---</option>';
                
                // é‡‘ã‚¹ã‚­ãƒ«
                const grpGold = document.createElement('optgroup');
                grpGold.label = "é‡‘ã‚¹ã‚­ãƒ« (ãƒ¬ã‚¢)";
                SKILLS_GOLD.forEach(s => {
                    const opt = document.createElement('option');
                    opt.value = s;
                    opt.textContent = s;
                    grpGold.appendChild(opt);
                });
                sel.appendChild(grpGold);

                // é’ã‚¹ã‚­ãƒ«
                const grpBlue = document.createElement('optgroup');
                grpBlue.label = "é’ã‚¹ã‚­ãƒ« (é€²åŒ–å¾Œãªã©)";
                SKILLS_BLUE.forEach(s => {
                    const opt = document.createElement('option');
                    opt.value = s;
                    opt.textContent = s;
                    grpBlue.appendChild(opt);
                });
                sel.appendChild(grpBlue);

                // ç™½ã‚¹ã‚­ãƒ«
                const grpWhite = document.createElement('optgroup');
                grpWhite.label = "ç™½ã‚¹ã‚­ãƒ«";
                SKILLS_WHITE.forEach(s => {
                    const opt = document.createElement('option');
                    opt.value = s;
                    opt.textContent = s;
                    grpWhite.appendChild(opt);
                });
                sel.appendChild(grpWhite);
            });
        }

        function updateNaturePreview() {
            const val = document.getElementById('p-nature').value;
            const data = NATURES[val];
            const div = document.getElementById('nature-preview');
            if (data && data.up) {
                div.innerHTML = `<span class="nature-up">â–² ${data.up}</span> / <span class="nature-down">â–¼ ${data.down}</span>`;
            } else {
                div.textContent = "è£œæ­£ãªã—";
            }
        }

        // --- ãƒ‡ãƒ¼ã‚¿æ“ä½œ ---
        function addPokemon() {
            const name = document.getElementById('p-name').value;
            if (!name) return alert("ãƒã‚±ãƒ¢ãƒ³åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");

            // ã‚µãƒ–ã‚¹ã‚­ãƒ«åé›†
            const skillSelects = document.querySelectorAll('.subskill-select');
            const skills = Array.from(skillSelects).map(sel => sel.value);

            const pokemon = {
                id: Date.now(),
                name: name,
                nature: document.getElementById('p-nature').value,
                ingredients: [
                    document.getElementById('ing-1').value,
                    document.getElementById('ing-30').value,
                    document.getElementById('ing-60').value
                ],
                subskills: skills,
                createdAt: new Date().toISOString()
            };

            let list = getList();
            list.push(pokemon);
            saveList(list);
            
            // ãƒ•ã‚©ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('p-name').value = "";
            skillSelects.forEach(s => s.value = "");
            document.querySelectorAll('.ing-select').forEach(s => s.value = "");
            
            loadPokemon();
        }

        function getList() { return JSON.parse(localStorage.getItem('pokeSleepV2')) || []; }
        function saveList(list) { localStorage.setItem('pokeSleepV2', JSON.stringify(list)); }

        function deletePokemon(id) {
            if(!confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
            let list = getList();
            list = list.filter(p => p.id !== id);
            saveList(list);
            loadPokemon();
        }

        // --- è¡¨ç¤º ---
        function loadPokemon() {
            const container = document.getElementById('pokemon-list');
            container.innerHTML = "";
            
            const searchText = document.getElementById('search-box').value.toLowerCase();
            const list = getList();

            const filtered = list.reverse().filter(p => {
                // åå‰ã€é£Ÿæã€ã‚¹ã‚­ãƒ«ã®ã„ãšã‚Œã‹ã«ãƒ’ãƒƒãƒˆã™ã‚Œã°è¡¨ç¤º
                const target = (p.name + p.ingredients.join('') + p.subskills.join('')).toLowerCase();
                return target.includes(searchText);
            });

            filtered.forEach(p => {
                const hasKinomiS = p.subskills.includes("ãã®ã¿ã®æ•°S");
                const card = document.createElement('div');
                card.className = `card ${hasKinomiS ? 'has-gold' : ''}`;

                // æ€§æ ¼è¡¨ç¤º
                const nData = NATURES[p.nature] || {up:null, down:null};
                const natureDisplay = nData.up 
                    ? `<span class="nature-up">â–²${nData.up}</span> <span class="nature-down">â–¼${nData.down}</span>` 
                    : `<span>è£œæ­£ãªã—</span>`;

                // ã‚µãƒ–ã‚¹ã‚­ãƒ«è¡¨ç¤ºæ§‹ç¯‰
                let skillsHtml = "";
                p.subskills.forEach((s, idx) => {
                    if(!s) return; // æœªé¸æŠã¯ã‚¹ã‚­ãƒƒãƒ—
                    let cls = "skill-tag";
                    if (SKILLS_GOLD.includes(s)) cls += " skill-gold";
                    else if (SKILLS_BLUE.includes(s)) cls += " skill-blue";
                    
                    const lvLabel = [10, 25, 50, 75, 100][idx];
                    skillsHtml += `<span class="${cls}">${lvLabel}:${s}</span>`;
                });

                card.innerHTML = `
                    <div class="card-header">
                        <span class="card-title">${p.name}</span>
                        <button class="btn btn-del" onclick="deletePokemon(${p.id})">å‰Šé™¤</button>
                    </div>
                    
                    <div class="info-grid">
                        <div>
                            <div class="info-label">æ€§æ ¼: ${p.nature}</div>
                            <div>${natureDisplay}</div>
                        </div>
                        <div>
                            <div class="info-label">é£Ÿæ</div>
                            <div class="ingredients-display">
                                ${p.ingredients.map(i => i ? `<span class="ing-badge">${i}</span>` : '').join('')}
                            </div>
                        </div>
                    </div>

                    <div style="margin-top:10px;">
                        <div class="info-label">ã‚µãƒ–ã‚¹ã‚­ãƒ«</div>
                        <div class="skills-list">${skillsHtml}</div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // --- Import/Export ---
        function exportData() {
            const list = getList();
            const blob = new Blob([JSON.stringify(list, null, 2)], {type: "application/json"});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `pokesleep_v2_${new Date().toISOString().slice(0,10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importData(input) {
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const json = JSON.parse(e.target.result);
                    if (!Array.isArray(json)) throw new Error("ãƒ‡ãƒ¼ã‚¿å½¢å¼ãŒé•ã„ã¾ã™");
                    if(confirm(`ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¸Šæ›¸ãã—ã¦èª­ã¿è¾¼ã¿ã¾ã™ã‹ï¼Ÿ`)) {
                        saveList(json);
                        loadPokemon();
                        alert("å®Œäº†ï¼");
                    }
                } catch (err) { alert("ã‚¨ãƒ©ãƒ¼: " + err.message); }
                input.value = '';
            };
            reader.readAsText(file);
        }
    </script>
</body>
</html>
